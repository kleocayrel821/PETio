{% extends "social/base_social.html" %}
{% block social_title %}Moderation Queue{% endblock %}
{% block sidebar %}{% include 'social/moderation/sidebar.html' %}{% endblock %}
{% block social_content %}
<div class="max-w-6xl mx-auto">
  <h1 class="text-2xl font-bold mb-4"><i class="fas fa-layer-group"></i> Queue</h1>
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div>
      <h2 class="text-lg font-semibold mb-2">Flagged Posts</h2>
      <div class="space-y-3">
        {% for post in flagged_posts %}
          <div class="card bg-base-100 shadow-sm hover:shadow-md transition-shadow"><div class="card-body">
            <p class="font-medium">{{ post.title }}</p>
            <p class="text-xs text-base-content/60">by {{ post.author.username }} • {{ post.created_at|timesince }} ago</p>
            <div class="flex items-center gap-2 mt-3">
              <form method="POST" action="{% url 'social:approve_post' post.id %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-xs btn-success">
                  <i class="fas fa-check"></i> Approve
                </button>
              </form>
              <details class="dropdown dropdown-top">
                <summary class="btn btn-xs btn-warning"><i class="fas fa-eye-slash"></i> Hide</summary>
                <div class="dropdown-content p-3 bg-base-200 rounded-box w-72 shadow-lg border border-base-300 z-50">
                  <form method="POST" action="{% url 'social:hide_post' post.id %}">
                    {% csrf_token %}
                    <label class="label"><span class="label-text text-xs">Reason</span></label>
                    <textarea name="reason" class="textarea textarea-bordered textarea-sm w-full" required></textarea>
                    <button type="submit" class="btn btn-xs btn-warning mt-2">Confirm Hide</button>
                  </form>
                </div>
              </details>
              <details class="dropdown dropdown-top">
                <summary class="btn btn-xs btn-error"><i class="fas fa-trash"></i> Delete</summary>
                <div class="dropdown-content p-3 bg-base-200 rounded-box w-72 shadow-lg border border-base-300 z-50">
                  <form method="POST" action="{% url 'social:moderate_delete_post' post.id %}" onsubmit="return confirm('Delete this post permanently?')">
                    {% csrf_token %}
                    <label class="label"><span class="label-text text-xs">Reason</span></label>
                    <textarea name="reason" class="textarea textarea-bordered textarea-sm w-full" required></textarea>
                    <button type="submit" class="btn btn-xs btn-error mt-2">Confirm Delete</button>
                  </form>
                </div>
              </details>
            </div>
          </div></div>
        {% empty %}
          <p class="text-base-content/60">No flagged posts.</p>
        {% endfor %}
      </div>
    </div>
    <div>
      <h2 class="text-lg font-semibold mb-2">Flagged Comments</h2>
      <div class="space-y-3">
        {% for comment in flagged_comments %}
          <div class="card bg-base-100 shadow-sm hover:shadow-md transition-shadow"><div class="card-body">
            <p class="text-sm">{{ comment.content|truncatewords:20 }}</p>
            <p class="text-xs text-base-content/60">by {{ comment.author.username }} • {{ comment.created_at|timesince }} ago</p>
            <div class="flex items-center gap-2 mt-3">
              <form method="POST" action="{% url 'social:approve_comment' comment.id %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-xs btn-success">
                  <i class="fas fa-check"></i> Approve
                </button>
              </form>
              <details class="dropdown dropdown-top">
                <summary class="btn btn-xs btn-warning"><i class="fas fa-eye-slash"></i> Hide</summary>
                <div class="dropdown-content p-3 bg-base-200 rounded-box w-72 shadow-lg border border-base-300 z-50">
                  <form method="POST" action="{% url 'social:hide_comment' comment.id %}">
                    {% csrf_token %}
                    <label class="label"><span class="label-text text-xs">Reason</span></label>
                    <textarea name="reason" class="textarea textarea-bordered textarea-sm w-full" required></textarea>
                    <button type="submit" class="btn btn-xs btn-warning mt-2">Confirm Hide</button>
                  </form>
                </div>
              </details>
              <details class="dropdown dropdown-top">
                <summary class="btn btn-xs btn-error"><i class="fas fa-trash"></i> Delete</summary>
                <div class="dropdown-content p-3 bg-base-200 rounded-box w-72 shadow-lg border border-base-300 z-50">
                  <form method="POST" action="{% url 'social:moderate_delete_comment' comment.id %}" onsubmit="return confirm('Delete this comment permanently?')">
                    {% csrf_token %}
                    <label class="label"><span class="label-text text-xs">Reason</span></label>
                    <textarea name="reason" class="textarea textarea-bordered textarea-sm w-full" required></textarea>
                    <button type="submit" class="btn btn-xs btn-error mt-2">Confirm Delete</button>
                  </form>
                </div>
              </details>
            </div>
          </div></div>
        {% empty %}
          <p class="text-base-content/60">No flagged comments.</p>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endblock %}