{% extends "base.html" %}
{% load static %}

{% block title %}{% block social_title %}IOsocial{% endblock %} - PETio{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'social/css/style.css' %}">
{% block social_extra_head %}{% endblock %}
{% endblock %}

{% block app_nav %}
<div class="tabs tabs-boxed social-nav">
    <a href="{% url 'social:home' %}" class="tab nav-link {% if request.resolver_match.url_name == 'home' %}tab-active{% endif %}">
        <i class="fas fa-home mr-2"></i>Home
    </a>
    <a href="{% url 'social:feed' %}" class="tab nav-link {% if request.resolver_match.url_name == 'feed' %}tab-active{% endif %}">
        <i class="fas fa-stream mr-2"></i>Feed
    </a>
    <a href="{% url 'social:dashboard' %}" class="tab nav-link {% if request.resolver_match.url_name == 'dashboard' %}tab-active{% endif %}">
        <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
    </a>
    <a href="{% url 'social:notifications' %}" class="tab nav-link {% if request.resolver_match.url_name == 'notifications' %}tab-active{% endif %}">
        <i class="fas fa-bell mr-2"></i>Notifications
        <span id="notifBadge" class="badge badge-primary ml-2" {% if unread_notifications_count|default:0 == 0 %}style="display:none;"{% endif %}>{{ unread_notifications_count|default:0 }}</span>
    </a>
    <a href="{% url 'social:create_post' %}" class="tab nav-link {% if request.resolver_match.url_name == 'create_post' %}tab-active{% endif %}">
        <i class="fas fa-plus mr-2"></i>Create Post
    </a>
</div>
{% endblock %}

{% block content %}
  {% block social_content %}{% endblock %}
{% endblock %}

{% block scripts %}
  <script src="{% static 'social/js/interactions.js' %}"></script>
  {% block social_scripts %}{% endblock %}
  {% block extra_js %}{% endblock %}
  <script>
    (function(){
      const badge = document.getElementById('notifBadge');
      if (!badge) return;
      function updateNotifCount(){
        fetch('{% url "social:notification_count" %}', {headers: {'X-Requested-With': 'XMLHttpRequest'}})
          .then(r => r.json())
          .then(data => {
            const count = data && typeof data.count === 'number' ? data.count : 0;
            if (count > 0) {
              badge.textContent = count;
              badge.style.display = '';
            } else {
              badge.style.display = 'none';
            }
          })
          .catch(() => {});
      }
      updateNotifCount();
      setInterval(updateNotifCount, 60000);
    })();
  </script>
{% endblock %}