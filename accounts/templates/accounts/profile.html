{% extends "base.html" %}
{% load static %}
{% block extra_head %}
<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Rubik', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
  .icon-inline { margin-right: 0.5rem; }
  .icon-badge-soft { display:inline-flex; align-items:center; justify-content:center; width:28px; height:28px; border-radius:8px; background: rgba(99,102,241,0.14); color:#4f46e5; }
  .profile-cover { height:240px; background: linear-gradient(135deg, #a78bfa 0%, #fbcfe8 55%, #93c5fd 100%); position:relative; overflow:hidden; border-radius:16px; box-shadow: 0 16px 32px rgba(17,24,39,0.12); }
  .profile-info-container { max-width:900px; margin:0 auto; position:relative; }
  .profile-avatar-container { position:absolute; top:-60px; left:20px; z-index:10; }
  .profile-avatar { width:120px; height:120px; border-radius:50%; border:5px solid white; box-shadow:0 8px 22px rgba(0,0,0,0.18); object-fit:cover; }
  .profile-header-content { background: rgba(255,255,255,0.9); backdrop-filter: saturate(180%) blur(6px); border-radius:16px; padding: 64px 20px 20px 168px; margin-top:-40px; box-shadow: 0 14px 28px rgba(17,24,39,0.10); }
  .profile-name { font-size:1.6rem; font-weight:700; color:#1f2937; margin:0; }
  .profile-username { color:#4b5563; font-size:0.95rem; margin:2px 0 8px; }
  @media (max-width: 768px) {
    .profile-avatar-container { left: 16px; top:-52px; }
    .profile-avatar { width:96px; height:96px; }
    .profile-header-content { padding: 56px 16px 16px 128px; }
    .profile-cover { height:200px; }
  }
</style>
{% endblock %}
{% block title %}My Profile • PETio{% endblock %}

{% block content %}
<div class="profile-content container mx-auto max-w-4xl py-6">
  <div class="profile-cover"></div>
  <div class="profile-info-container">
    <div class="profile-avatar-container">
      {% if user_obj.profile.avatar %}
        <img class="profile-avatar" src="{{ user_obj.profile.avatar.url }}" alt="{{ user_obj.username }} avatar">
      {% else %}
        <img class="profile-avatar" src="https://ui-avatars.com/api/?name={{ user_obj.get_full_name|default:user_obj.username|urlencode }}&size=128&background=6366f1&color=fff" alt="avatar placeholder">
      {% endif %}
    </div>
    <div class="profile-header-content">
      <div class="flex items-center justify-between mb-2">
        <div>
          <h1 class="profile-name">{{ user_obj.get_full_name|default:user_obj.username }}</h1>
          <div class="profile-username">@{{ user_obj.username }}</div>
          <div class="text-sm text-gray-500">{{ user_obj.email }}</div>
          <div class="text-sm text-gray-500">Member since {{ user_obj.date_joined|date:"M d, Y" }}</div>
        </div>
        <div class="flex items-center gap-2">
          <a href="{% url 'accounts:profile_edit' %}" class="btn btn-ghost btn-sm"><i class="fas fa-edit"></i> Edit</a>
        </div>
      </div>
      <div class="stats stats-vertical md:stats-horizontal bg-base-100 border rounded-xl shadow mt-3">
        <div class="stat">
          <div class="stat-figure text-primary"><i class="fas fa-feather"></i></div>
          <div class="stat-title">Posts</div>
          <div class="stat-value">{{ user_obj.social_posts.count }}</div>
        </div>
        <div class="stat">
          <div class="stat-figure text-primary"><i class="fas fa-user-plus"></i></div>
          <div class="stat-title">Followers</div>
          <div class="stat-value">{{ user_obj.social_followers_set.count }}</div>
        </div>
        <div class="stat">
          <div class="stat-figure text-primary"><i class="fas fa-user-friends"></i></div>
          <div class="stat-title">Following</div>
          <div class="stat-value">{{ user_obj.social_following_set.count }}</div>
        </div>
        <div class="stat">
          <div class="stat-figure text-primary"><i class="fas fa-store"></i></div>
          <div class="stat-title">Listings</div>
          <div class="stat-value">{{ user_obj.listings.count }}</div>
        </div>
      </div>
    </div>
  </div>

  

  

  <div class="enhanced-card mb-4">
    <div class="section-title flex items-center justify-between">
      <span><span class="icon-badge-soft icon-inline"><i class="fas fa-star"></i></span> Seller Ratings</span>
      <button type="button" class="btn btn-ghost btn-sm btn-enhanced collapse-toggle" data-target="#ratingsBodyAcc"><i class="fas fa-chevron-up"></i></button>
    </div>
    <div id="ratingsBodyAcc">
      <div class="flex items-center gap-4 mb-3">
        <div class="rating-ring" style="--value: {{ seller_rating_avg|default:0|floatformat:2 }}">
          <div class="ring-inner">{{ seller_rating_avg|floatformat:1 }}</div>
        </div>
        <div>
          <div class="font-semibold">Average <span class="opacity-70">/ 5</span></div>
          <div class="text-sm opacity-70">{{ seller_rating_count }} total reviews</div>
        </div>
      </div>
      {% if seller_rating_count > 0 %}
        <div>
          <div class="subsection-title"><i class="fas fa-history"></i> Recent Reviews</div>
          <ul class="space-y-2">
            {% for r in recent_ratings %}
              <li class="timeline-item">
                <div class="timeline-title">
                  <i class="fas fa-star text-yellow-400"></i> {{ r.score }}/5 from @{{ r.buyer.username }}
                </div>
                {% if r.listing %}<div class="timeline-meta">on {{ r.listing.title }} • {{ r.created_at|date:"M d, Y" }}</div>{% else %}
                <div class="timeline-meta">{{ r.created_at|date:"M d, Y" }}</div>{% endif %}
                {% if r.comment %}<div class="text-sm mt-1">“{{ r.comment }}”</div>{% endif %}
              </li>
            {% endfor %}
          </ul>
        </div>
      {% else %}
        <div class="text-sm opacity-70">No reviews yet.</div>
      {% endif %}
    </div>
  </div>

  <div class="enhanced-card mb-4">
    <div class="section-title flex items-center justify-between">
      <span><span class="icon-badge-soft icon-inline"><i class="fas fa-stream"></i></span> Activity</span>
      <button type="button" class="btn btn-ghost btn-sm btn-enhanced collapse-toggle" data-target="#activityBodyAcc"><i class="fas fa-chevron-up"></i></button>
    </div>
    <div id="activityBodyAcc" class="timeline">
      {% if recent_ratings %}
        {% for r in recent_ratings %}
          <div class="timeline-item">
            <div class="timeline-title"><i class="fas fa-star text-yellow-400"></i> Received a {{ r.score }}/5 rating from @{{ r.buyer.username }}</div>
            <div class="timeline-meta">{{ r.created_at|date:"M d, Y" }}{% if r.listing %} • on {{ r.listing.title }}{% endif %}</div>
          </div>
        {% endfor %}
      {% else %}
        <div class="text-sm opacity-70">No recent activity</div>
      {% endif %}
    </div>
  </div>

  <div class="enhanced-card">
    <div class="section-title flex items-center justify-between">
      <span><span class="icon-badge-soft icon-inline"><i class="fas fa-user"></i></span> Profile Details</span>
      <button type="button" class="btn btn-ghost btn-sm btn-enhanced collapse-toggle" data-target="#detailsBodyAcc"><i class="fas fa-chevron-up"></i></button>
    </div>
    <div id="detailsBodyAcc" class="grid grid-cols-1 md:grid-cols-2 gap-3">
      <div><div class="text-sm text-gray-500">Display Name</div><div class="font-medium">{{ user_obj.profile.display_name|default:"(not set)" }}</div></div>
      <div><div class="text-sm text-gray-500">Location</div><div class="font-medium">{{ user_obj.profile.location|default:"(not set)" }}</div></div>
      <div><div class="text-sm text-gray-500">Phone</div><div class="font-medium">{{ user_obj.profile.phone|default:"(not set)" }}</div></div>
      <div class="md:col-span-2"><div class="text-sm text-gray-500">Bio</div><div class="font-medium">{{ user_obj.profile.bio|default:"(not set)" }}</div></div>
    </div>
  </div>
</div>
{% endblock %}
{% block extra_js %}
<script src="{% static 'js/auth.js' %}"></script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  document.querySelectorAll('.collapse-toggle').forEach(function(btn){
    btn.addEventListener('click', function(){
      var targetSel = this.getAttribute('data-target');
      var target = document.querySelector(targetSel);
      if (!target) return;
      var isHidden = target.classList.toggle('hidden');
      var icon = this.querySelector('i');
      if (icon) icon.className = isHidden ? 'fas fa-chevron-down' : 'fas fa-chevron-up';
    });
  });
});
</script>
{% endblock %}
