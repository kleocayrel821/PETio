{% extends "marketplace/admin/admin_base.html" %}
{% block admin_title %}Marketplace Admin{% endblock %}

{% block admin_sidebar %}
<!-- Mobile Navigation Toggle -->
<button class="sidebar-toggle md:hidden fixed top-4 left-4 z-50 bg-white rounded-lg shadow-md p-2" id="mobile-nav-toggle" aria-label="Open admin sidebar">
  <i data-lucide="menu" class="w-6 h-6"></i>
  <span class="sr-only">Open navigation</span>
</button>

<!-- Mobile Overlay -->
<div class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-30 hidden" id="mobile-overlay" aria-hidden="true"></div>

<aside class="admin-sidebar" id="admin-sidebar">
  <div class="sidebar-header">
    <h2 class="sidebar-brand">Admin Panel</h2>
    <button class="sidebar-toggle md:hidden" id="sidebar-close" aria-label="Close admin sidebar">
      <i data-lucide="x" class="w-5 h-5"></i>
      <span class="sr-only">Close navigation</span>
    </button>
  </div>

  <!-- User Profile Section -->
  <div class="sidebar-user">
    <div class="avatar placeholder">
      <div class="bg-neutral text-neutral-content rounded-full w-10">
        <span>{{ request.user.username|default:'A'|slice:':1'|upper }}</span>
      </div>
    </div>
    <div>
      <div class="user-name">{{ request.user.get_username|default:'Admin' }}</div>
      <div class="user-role badge badge-sm badge-primary">{% if request.user.is_superuser %}Superuser{% elif request.user.is_staff %}Admin{% else %}User{% endif %}</div>
    </div>
  </div>
  
  <nav class="sidebar-nav" aria-label="Admin sections">
    <a href="{% url 'marketplace_admin:listings' %}" 
       class="sidebar-item {% if active_tab == 'listings' %}active{% endif %}">
      <i data-lucide="file-text" class="w-5 h-5"></i>
      <span>Listings</span>
      {% if pending_listings %}<span class="sidebar-badge">{{ pending_listings|length }}</span>{% endif %}
    </a>
    
    <a href="{% url 'marketplace_admin:reports' %}" 
       class="sidebar-item {% if active_tab == 'reports' %}active{% endif %}">
      <i data-lucide="flag" class="w-5 h-5"></i>
      <span>Reports</span>
      {% if reports %}<span class="sidebar-badge">{{ reports|length }}</span>{% endif %}
    </a>
    
    <a href="{% url 'marketplace_admin:analytics' %}" 
       class="sidebar-item {% if active_tab == 'analytics' %}active{% endif %}">
      <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
      <span>Analytics</span>
    </a>
    
    <a href="{% url 'marketplace_admin:users' %}" 
       class="sidebar-item {% if active_tab == 'users' %}active{% endif %}">
      <i data-lucide="users" class="w-5 h-5"></i>
      <span>Users</span>
    </a>
    
    <a href="{% url 'marketplace_admin:notifications' %}" 
       class="sidebar-item {% if active_tab == 'notifications' %}active{% endif %}">
      <i data-lucide="megaphone" class="w-5 h-5"></i>
      <span>Notifications</span>
    </a>
  </nav>
  
  <div class="sidebar-footer">
    {% comment %} Logout link dynamically resolved based on project URL config {% endcomment %}
    {% if logout_url_name and request.user.is_authenticated and request.user.is_active %}
      <form method="post" action="{% url logout_url_name %}" class="sidebar-item text-red-600 hover:bg-red-50">
        {% csrf_token %}
        <input type="hidden" name="next" value="{% url 'login' %}">
        <button type="submit" class="flex items-center gap-2">
          <i data-lucide="log-out" class="w-5 h-5"></i>
          <span>Logout</span>
        </button>
      </form>
    {% endif %}
  </div>
</aside>

<script>
// Mobile Navigation JavaScript
document.addEventListener('DOMContentLoaded', function() {
  // Sidebar interactions are handled by unified admin.js (AdminUtils)
  // This inline script remains for resilience but defers to AdminUtils
  const mobileToggle = document.getElementById('mobile-nav-toggle');
  const sidebarClose = document.getElementById('sidebar-close');
  const sidebar = document.getElementById('admin-sidebar');
  const overlay = document.getElementById('mobile-overlay');
  function openSidebar() { if (!sidebar || !overlay) return; sidebar.classList.add('open'); overlay.classList.remove('hidden'); document.body.style.overflow = 'hidden'; }
  function closeSidebar() { if (!sidebar || !overlay) return; sidebar.classList.remove('open'); overlay.classList.add('hidden'); document.body.style.overflow = ''; }
  mobileToggle && mobileToggle.addEventListener('click', openSidebar);
  sidebarClose && sidebarClose.addEventListener('click', closeSidebar);
  overlay && overlay.addEventListener('click', closeSidebar);
});
</script>
{% endblock %}

{% block admin_content %}
{% if active_tab == 'listings' %}
  {% include "marketplace/admin/_admin_listings_tab.html" with pending_listings=pending_listings approve_action_name='marketplace_admin:approve_listing' reject_action_name='marketplace_admin:reject_listing' rejection_reason_choices=rejection_reason_choices %}
{% elif active_tab == 'reports' %}
  {% include "marketplace/admin/_admin_reports_tab.html" with reports=reports close_action_name='marketplace_admin:close_report' %}
{% elif active_tab == 'analytics' %}
  {% include "marketplace/admin/_admin_analytics_tab.html" %}
{% elif active_tab == 'users' %}
  {% include "marketplace/admin/_admin_users_tab.html" %}
{% elif active_tab == 'notifications' %}
  {% include "marketplace/admin/_admin_notifications_tab.html" %}
{% endif %}
{% endblock %}